<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Enigma Simulator</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #222; color: #0f0; text-align: center; margin-top: 50px; }
        
        .machine-container {
            background: #333;
            width: 500px;
            margin: 0 auto;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #555;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }

        img { width: 150px; height: 150px; margin-bottom: 20px; }
        
        #displayScreen { 
            background: #000; 
            border: 4px solid #666; 
            color: #0f0; 
            padding: 20px; 
            font-size: 1.5em; 
            font-weight: bold; 
            min-height: 1.5em; 
            margin-bottom: 20px;
            word-wrap: break-word;
        }

        input { padding: 10px; font-size: 1em; width: 70%; margin-bottom: 10px; }
        
        button { padding: 10px 20px; font-size: 1.1em; cursor: pointer; margin: 5px; font-weight: bold; border-radius: 5px; }
        
        .lock-btn { background-color: #ff4444; color: white; border: none; }
        .unlock-btn { background-color: #44ff44; color: black; border: none; }

        /* Stil f칬r n칛r en knapp 칛r inaktiverad */
        button:disabled {
            background-color: #555;
            color: #888;
            cursor: not-allowed;
            opacity: 0.6;
        }

    </style>
</head>
<body>

    <div class="machine-container">
        <h1>ENIGMA MACHINE</h1>

        <img id="statusImage" src="locked.png" alt="Status">

        <div id="displayScreen">IFMMP!XPSME</div>
        
        <button id="btnUnlock" class="unlock-btn" onclick="unlockMachine()">游댑 UNLOCK & DECRYPT</button>
        
        <hr style="border-color: #444; margin: 20px 0;">

        <p style="color: #aaa; font-size: 0.8em;">CREATE NEW SECRET:</p>
        <input type="text" id="inputText" placeholder="Write plain text here...">
        <br>
        <button id="btnLock" class="lock-btn" onclick="lockMachine()">游 ENCRYPT & LOCK</button>
    </div>

    <script>
        // Vi h친ller koll p친 tillst친ndet h칛r:
        let isLocked = true; 

        // K칬rs direkt n칛r sidan laddas f칬r att s칛tta r칛tt knapp-status
        updateButtonState();

        async function unlockMachine() {
            // STOPP! Om den inte 칛r l친st, g칬r ingenting.
            if (!isLocked) return;

            const currentText = document.getElementById('displayScreen').innerText;
            const response = await fetch(`/decrypt?text=${encodeURIComponent(currentText)}`);
            const decryptedText = await response.text();

            document.getElementById('displayScreen').innerText = decryptedText;
            document.getElementById('displayScreen').style.color = "#44ff44";
            document.getElementById('statusImage').src = 'unlocked.png';

            // Uppdatera tillst친ndet
            isLocked = false;
            updateButtonState();
        }

        async function lockMachine() {
            const textInput = document.getElementById('inputText').value;

            if (!textInput) {
                alert("Please write a message to encrypt first!");
                return;
            }

            const response = await fetch(`/encrypt?text=${encodeURIComponent(textInput)}`);
            const encryptedText = await response.text();

            document.getElementById('displayScreen').innerText = encryptedText;
            document.getElementById('displayScreen').style.color = "#ff4444"; 
            document.getElementById('statusImage').src = 'locked.png';
            document.getElementById('inputText').value = "";

            // Uppdatera tillst친ndet
            isLocked = true;
            updateButtonState();
        }

        // Hj칛lpfunktion som gr친ar ut knapparna beroende p친 l칛ge
        function updateButtonState() {
            const btnUnlock = document.getElementById('btnUnlock');
            const btnLock = document.getElementById('btnLock');

            if (isLocked) {
                // Om l친st: Man kan l친sa upp, men inte l친sa igen
                btnUnlock.disabled = false;
                btnLock.disabled = true; // Man m친ste l친sa upp innan man skapar ny kod
            } else {
                // Om 칬ppen: Man kan inte l친sa upp, men man kan l친sa
                btnUnlock.disabled = true;
                btnLock.disabled = false;
            }
        }
    </script>
</body>
</html>